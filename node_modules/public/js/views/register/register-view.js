define([
  'views/base/view',
  'text!templates/register/register-view.hbs'
], function(View, template) {
  'use strict';

	var RegisterView = View.extend({
	    autoRender: true,

	    template: template,

		events: {
	   		"submit form": "registrate"
	   	},

	    registrate: function () {

	      	$.ajax({url: "http://localhost:100/register", 
		      	method:"POST",
		      	data:JSON.stringify({
		      		nick:$("#Nick").val(),
		      		pwd:$("#Password").val(),
		      		repeatPwd:$("#repeatPassword").val(),
		      		email:$("#Email").val()
		      	}),
		      	
		        success: function(result) {
		      	 	config.user = $('#Nick').val();
		      		config.pwd = $('#Password').val();

					localStorage.clear()

		          	console.log(result);
		          	location.hash="#/me/show";
		        },
		        error: function(xhr,status,error) {
		        	$("#Password").parent().removeClass("form-group has-error").addClass("form-group");
		       		$("#repeatPassword").parent().removeClass("form-group has-error").addClass("form-group");
		       		$("#Email").parent().removeClass("form-group has-error").addClass("form-group");
		       		$("#Nick").parent().removeClass("form-group has-error").addClass("form-group");

				    if('Email is required'==JSON.parse(xhr.responseText).message || 
				        "Email is already used"==JSON.parse(xhr.responseText).message) 
				       	$("#Email").parent().addClass("form-group has-error");

				    else if("Nick is required"==JSON.parse(xhr.responseText).message || 
				        "Nick is already used"==JSON.parse(xhr.responseText).message) 
				       	$("#Nick").parent().addClass("form-group has-error");

				    else if("Passwords do not match"==JSON.parse(xhr.responseText).message ||
				    	"Password is required"==JSON.parse(xhr.responseText).message) {
				       	$("#Password").parent().addClass("form-group has-error");
				       	$("#repeatPassword").parent().addClass("form-group has-error");
			    	}
			    	$("#er").text(JSON.parse(xhr.responseText).message).css("display","block");		       		
		       	}
	      	})
	    }
	});
  	return RegisterView;
})