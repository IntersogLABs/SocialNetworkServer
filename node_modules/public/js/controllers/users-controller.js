define([
  'controllers/base/controller',
  'models/users/users-collection',
  'models/posts/user-post-collection',
  'views/users/users-collection-view',
  'views/posts/user-post-collection-view',
  'views/users/user-view',
  'models/users/user-model',
], function(Controller, UserCollection, UserPostCollection, UsersCollectionView, 
  UserPostCollectionView, UserView, UserModel) {
  'use strict';

  var UsersController = Controller.extend({

    beforeAction: function(){
      var superResult = Controller.prototype.beforeAction.apply(this, arguments)


      this.reuse('main-post', {
        compose: function() {
          this.collection = new UserCollection();

          this.view = new UsersCollectionView({
            collection: this.collection,
            region: 'sidebar'
          });

          this.collection.fetch().then( function() { this.view.render() }.bind(this))
        }
      });

      return superResult
    },
    

    index: function(params) {
      if(!params.id) return;

      this.model= new UserModel({id: params.id});

      this.userView = new UserView({
        model: this.model,
        region: 'content'
      });

      this.postscollection=new UserPostCollection();

      this.viewPosts= new UserPostCollectionView({
        collection:this.postscollection,
        region:"content"
      })

      this.model.fetch().then(function() { this.userView.render(); }.bind(this));
      this.postscollection.fetch().then(function(){ this.viewPosts.render() }.bind(this));
    }
  });

  return UsersController;
});
